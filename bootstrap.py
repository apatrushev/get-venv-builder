"""ATTENTION!!!
This is autogenerated file. Please change it
only in case if you know what you are doing
"""
import base64
import contextlib
import os
import shutil
import sys
import tempfile
import zlib


VENV_FOLDER = 'venv'
VENV_PYTHON = os.path.join(
    os.path.abspath(VENV_FOLDER),
    'Scripts' if sys.platform == 'win32' else 'bin',
    'python'
)
VENV_BOOT_DATA = """eNrFVduO2zYQfddXsMiDJMPherfoS4AtmgZOYaBwjGwuKIJAoKWRzYQiVXLk
WA3y7x1S17je9rEGFsvh3A7PXFRaU7EsKxtsLGQZk1VtLLLaSo10q3OURkelt8qNRjijkvvBKlfGSX1Y
DqpKaHEAG/Vq44aTheHk2vEShS2lGjUIVT2X3bFBqUbJqQht+yxi9AtwGqsIyt2AhURTg570D0hvOGxe
DQaDHME5hxrZJlyvrTX2H1G5hT8bcPhocGkG1a8tgqMswk0Zot0fu032br19l+2e/7Zm9yw+Itbu2c1N
3daS1y0ejebGHoJ8c5IWG6FAn+Jos9282Tz/PSNn71e3T+l6FUdRlOOZbogInlsQCFkBpWgUZj37SepN
eH6E/HN2NA61qIA8XgrlIKhOYGXZZpUpoI/0Yv36TbZ9tV1T/F8uqkjhqXCVOYm9gsyXp5A2STuyqHgH
QIoylI1Xnwt/JhRe30pQRW8VLrpycluhBUg6RUpZnzAntMSWBdyRLKlteC3wyOEsHbpkRkjKjGUDAiuk
A/a60SgrCGVMYqKKEUjI0diWCUU8FS3rAsVpBIrCE80JdSEnBKeU/cxumdDFZdLB4MPtx39J54AoK5hD
4ov9R256aAmYH9nJG1JDRV8kHocRSvoOS77vnHGy7ql8aeqbzIKrO0SyDAInInOqaJKyH+7Z3WrVaR/D
/N4afQiORpOS8II8QdfVu3a3ibv6FQQ7I1BU4a3R0HU+sa+kBib1DIb/VWRmqQUEPTDZx3yRhH7ni6mz
+YJqzg9/pXxRFT/xRbwMsdIxBj2H5soxbTCknKJf4Kn4wZqmdkn6YfXRN8yoI+/J89rjJzjBKeQqTaOL
uGvFl12FJquRluvVGjLzAroS/I8FEyhCFSiBb72ke9FbTbRHvXJYUImX0+5JVybco/ZCRlKH7bvH93ub
Bwb8yew/3YeIwdOfphd5iYYKrchRKJUMcTvQfhayuiVow/x9MlIno/dgvRxvyE4R6R7nGIraYDKY1Zj2
bBzuiQr/7wl7ERYnw6PvYYlSKD+2UR+Yhp5iJvHX1Tf29Zb+7r7FnJqe2josBDhD3qDnajkgX7L5egpT
/jBbCtG1fdORs5c6K40qwPo1T1Ls+8Mb1kqgz+q7I/4i9Y93MQNa4Sx+yK2saZvMufNfkkv+ZpiWs0RL
/znx9n3LXDz5acVqWRMxzldqNgUjCbOU6WMhZsNDHF5zXbL5dk2vfB3mnP4NeU7YRQ==
"""


@contextlib.contextmanager
def removable_tempdir():
    target = tempfile.mkdtemp()
    yield target
    shutil.rmtree(target)


def main(executable, *args):
    if os.path.exists(VENV_FOLDER) and '--renew' in args:
        shutil.rmtree(VENV_FOLDER)

    if not os.path.exists(VENV_FOLDER):
        with removable_tempdir() as temp_dir:
            venv_boot_filename = os.path.join(temp_dir, 'venv-boot.py')
            data = base64.b64decode(VENV_BOOT_DATA)
            data = zlib.decompress(data)
            with open(venv_boot_filename, 'wb') as venv_boot_file:
                venv_boot_file.write(data)

            os.system('{0} {1} {2}'.format(
                sys.executable,
                venv_boot_filename,
                VENV_FOLDER
            ))
        post_create()


def post_create():
    import os
    VENV_PYTHON = globals().get('VENV_PYTHON', 'python')
    URL = 'git+https://github.com/apatrushev/get-venv-builder'
    os.system('{0} -m pip install {1}'.format(VENV_PYTHON, URL))
    pass


if __name__ == '__main__':
    main(*sys.argv)
